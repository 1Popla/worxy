<div class="hidden lg:block w-64 bg-white shadow-lg">
  <nav class="h-full px-4 py-6">
    <div class="mb-8">
      <a href="/dashboard"><img src="/images/worxy-logo-cropped.png" alt="Logo" style="width: 75%;"></a>
    </div>
    <ul class="space-y-2">
      <li>
        <%= link_to dashboard_index_path, data: { turbo: true }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-tachometer-alt mr-2 text-gray-700"></i>
          Dashboard
        <% end %>
      </li>
      <li>
        <%= link_to new_post_path, data: { turbo: true }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-plus mr-2 text-gray-700"></i>
          Nowe ogłoszenie
        <% end %>
      </li>
      <li>
        <%= link_to posts_path, data: { turbo: true }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-list mr-2 text-gray-700"></i>
          Ogłoszenia
        <% end %>
      </li>
      <li>
        <%= link_to user_posts_posts_path, data: { turbo: true }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-user mr-2 text-gray-700"></i>
          Moje Ogłoszenia
        <% end %>
      </li>
      <li>
        <%= link_to conversations_path, data: { turbo: true }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-comments mr-2 text-gray-700"></i>
          Wiadomości
        <% end %>
      </li>
      <li class="relative">
        <%= link_to notifications_path, data: { turbo: true }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-gray-700 notification-bell' do %>
          <i class="fas fa-bell mr-2 text-gray-700"></i>
          Moje Powiadomienia
          <span id="notification-count" class="absolute top-0 right-0 mt-1 mr-2 h-5 w-5 text-xs text-black bg-yellow-400 rounded-full flex items-center justify-center hidden"></span>
        <% end %>
      </li>
      <li>
        <%= link_to bookings_path, data: { turbo: true }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-briefcase mr-2 text-gray-700"></i>
          Zlecenia
        <% end %>
      </li>
      <li>
        <%= link_to calendar_bookings_path, data: { turbo: true }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-calendar-alt mr-2 text-gray-700"></i>
          Zobacz Kalendarz
        <% end %>
      </li>
      <li>
        <%= link_to dashboard_map_path, data: { turbo: true }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-map mr-2 text-gray-700"></i>
          Mapa Zleceń
        <% end %>
      </li>
      <li>
        <%= link_to user_path(current_user), data: { turbo: true }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-user-circle mr-2 text-gray-700"></i>
          Profil Użytkownika
        <% end %>
      </li>
      <li>
        <%= link_to destroy_user_session_path, method: :delete, data: { turbo: false, confirm: 'Are you sure?' }, class: 'flex items-center block p-2 rounded hover:bg-gray-200 text-red-600' do %>
          <i class="fas fa-sign-out-alt mr-2 text-gray-700"></i>
          Wyloguj
        <% end %>
      </li>
    </ul>
  </nav>
</div>

<!-- Mobile Navbar -->
<div class="lg:hidden bg-white shadow-lg fixed top-0 left-0 right-0 z-50 min-w-[300px]">
  <div class="flex items-center justify-between p-4">
    <a href="/dashboard"><img src="/images/worxy-logo-cropped.png" alt="Logo" style="width: 50%;"></a>
    <button id="hamburger" class="text-gray-700 focus:outline-none">
      <i class="fas fa-bars text-2xl"></i>
    </button>
  </div>
</div>

<!-- Mobile Dropdown Menu -->
<div id="mobile-menu" class="lg:hidden hidden fixed top-16 left-0 bg-white w-full max-h-0 overflow-hidden rounded-t-lg shadow-lg z-40 transition-all duration-300 ease-in-out">
  <div class="p-4">
    <ul class="space-y-2">
      <li>
        <%= link_to dashboard_index_path, data: { turbo: true }, class: 'block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-tachometer-alt mr-2 text-gray-700"></i>
          Dashboard
        <% end %>
      </li>
      <li>
        <%= link_to new_post_path, data: { turbo: true }, class: 'block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-plus mr-2 text-gray-700"></i>
          Nowe ogłoszenie
        <% end %>
      </li>
      <li>
        <%= link_to posts_path, data: { turbo: true }, class: 'block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-list mr-2 text-gray-700"></i>
          Ogłoszenia
        <% end %>
      </li>
      <li>
        <%= link_to user_posts_posts_path, data: { turbo: true }, class: 'block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-user mr-2 text-gray-700"></i>
          Moje Ogłoszenia
        <% end %>
      </li>
      <li>
        <%= link_to conversations_path, data: { turbo: true }, class: 'block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-comments mr-2 text-gray-700"></i>
          Wiadomości
        <% end %>
      </li>
      <li class="relative">
        <%= link_to notifications_path, data: { turbo: true }, class: 'block p-2 rounded hover:bg-gray-200 text-gray-700 notification-bell' do %>
          <i class="fas fa-bell mr-2 text-gray-700"></i>
          Moje Powiadomienia
          <span id="notification-count-mobile" class="absolute top-0 right-0 mt-1 mr-2 h-5 w-5 text-xs text-black bg-yellow-400 rounded-full flex items-center justify-center hidden"></span>
        <% end %>
      </li>
      <li>
        <%= link_to bookings_path, data: { turbo: true }, class: 'block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-briefcase mr-2 text-gray-700"></i>
          Zlecenia
        <% end %>
      </li>
      <li>
        <%= link_to calendar_bookings_path, data: { turbo: true }, class: 'block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-calendar-alt mr-2 text-gray-700"></i>
          Zobacz Kalendarz
        <% end %>
      </li>
      <li>
        <%= link_to dashboard_map_path, data: { turbo: true }, class: 'block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-map mr-2 text-gray-700"></i>
          Mapa Zleceń
        <% end %>
      </li>
      <li>
        <%= link_to user_path(current_user), data: { turbo: true }, class: 'block p-2 rounded hover:bg-gray-200 text-gray-700' do %>
          <i class="fas fa-user-circle mr-2 text-gray-700"></i>
          Profil Użytkownika
        <% end %>
      </li>
      <li>
        <%= link_to destroy_user_session_path, method: :delete, data: { turbo: false, confirm: 'Are you sure?' }, class: 'block p-2 rounded hover:bg-gray-200 text-red-600' do %>
          <i class="fas fa-sign-out-alt mr-2 text-gray-700"></i>
          Wyloguj
        <% end %>
      </li>
    </ul>
  </div>
</div>

<script>
  document.getElementById('hamburger').addEventListener('click', function () {
    var menu = document.getElementById('mobile-menu');
    if (menu.classList.contains('hidden')) {
      menu.classList.remove('hidden');
      menu.style.maxHeight = menu.scrollHeight + 'px';
    } else {
      menu.style.maxHeight = '0';
      menu.addEventListener('transitionend', function () {
        menu.classList.add('hidden');
      }, { once: true });
    }
  });

  function updateNotificationBell() {
    fetch('/notifications/unread_count')
      .then(response => {
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        const count = data.unread_count;
        const notificationCountElements = document.querySelectorAll('#notification-count, #notification-count-mobile');

        notificationCountElements.forEach(el => {
          el.textContent = count;
          if (count > 0) {
            el.classList.remove('hidden');
            el.classList.add('block');
            const bells = document.querySelectorAll('.notification-bell');
            bells.forEach(bell => {
              bell.classList.add('animate-bounce');
            });
          } else {
            el.classList.remove('block');
            el.classList.add('hidden');
            const bells = document.querySelectorAll('.notification-bell');
            bells.forEach(bell => {
              bell.classList.remove('animate-bounce');
            });
          }
        });
      })
      .catch(error => {
        console.error('Fetch error:', error);
      });
  }

  document.addEventListener('turbo:load', updateNotificationBell);
  document.addEventListener('turbo:frame-load', updateNotificationBell);
  document.addEventListener('turbo:before-render', updateNotificationBell);
</script>
