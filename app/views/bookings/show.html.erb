<div class="flex h-screen bg-gray-100 overflow-hidden">
  <%= render 'shared/dashboard/sidebar' %>

  <div class="flex-1 overflow-auto">
    <div class="container mx-auto px-4 py-8">
      <div class="bg-white shadow-lg rounded-lg p-8 relative">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="col-span-2">
            <h1 class="text-3xl font-semibold mb-6 border-b pb-4">Szczegóły Rezerwacji</h1>
            <table class="w-full text-left">
              <tbody>
                <tr class="border-b">
                  <td class="font-medium py-2">Nazwa ogłoszenia:</td>
                  <td class="py-2"><%= link_to @booking.post.title, @booking.post, class: "text-blue-500 hover:text-blue-700" %></td>
                </tr>
                <tr class="border-b">
                  <td class="font-medium py-2">Status:</td>
                  <td class="py-2"><%= @booking.status %></td>
                </tr>
                <tr class="border-b">
                  <td class="font-medium py-2">Data rozpoczęcia:</td>
                  <td class="py-2"><%= I18n.l(@booking.start_date, format: :long) %></td>
                </tr>
                <tr class="border-b">
                  <td class="font-medium py-2">Data zakończenia:</td>
                  <td class="py-2"><%= I18n.l(@booking.end_date, format: :long) %></td>
                </tr>
                <tr class="border-b">
                  <td class="font-medium py-2">Proponowana cena:</td>
                  <td class="py-2"><%= number_to_currency(@booking.offered_price) %></td>
                </tr>
              </tbody>
            </table>

            <h2 class="text-2xl font-semibold mt-8 mb-4 border-b pb-2">Dane ogłoszenia:</h2>
            <table class="w-full text-left">
              <tbody>
                <tr class="border-b">
                  <td class="font-medium py-2">Opis:</td>
                  <td class="py-2"><%= @booking.post.description %></td>
                </tr>
                <tr class="border-b">
                  <td class="font-medium py-2">Pierwotna cena:</td>
                  <td class="py-2"><%= number_to_currency(@booking.post.price) %></td>
                </tr>
                <tr class="border-b">
                  <td class="font-medium py-2">Priorytet:</td>
                  <td class="py-2"><%= @booking.post.availability %></td>
                </tr>
                <tr class="border-b">
                  <td class="font-medium py-2">Dane kontaktowe:</td>
                  <td class="py-2"><%= @booking.post.contact_information %></td>
                </tr>
              </tbody>
            </table>

            <h2 class="text-2xl font-semibold mt-8 mb-4 border-b pb-2">Dane zleceniodawcy:</h2>
            <table class="w-full text-left">
              <tbody>
                <tr class="border-b">
                  <td class="font-medium py-2">Zabookowane przez:</td>
                  <td class="py-2"><%= @booking.user.email %></td>
                </tr>
                <% if @booking.visible_to_user %>
                <tr class="border-b">
                  <td class="font-medium py-2">Widoczne dla:</td>
                  <td class="py-2"><%= @booking.visible_to_user.email %></td>
                </tr>
                <% end %>
                <tr class="border-b">
                  <td class="font-medium py-2">Utworzone przez:</td>
                  <td class="py-2"><%= @booking.post.user.email %></td>
                </tr>
              </tbody>
            </table>
          </div>
          <% if @booking.post.images.attached? %>
          <div class="md:absolute md:top-8 md:right-8">
            <p class="text-center font-medium mb-2">Zdjęcie główne zgłoszenia</p>
            <div class="flex justify-center items-center w-48 h-36">
              <div class="w-full h-full object-cover rounded-lg border border-gray-200 shadow-sm overflow-hidden">
                <%= image_tag @booking.post.images.first.variant(resize_to_fill: [300, 225]), class: "w-full h-full object-cover" %>
              </div>
            </div>
          </div>
          <% end %>
        </div>

        <div class="mt-8 flex space-x-4">
          <%= link_to 'Edytuj zlecenie', edit_booking_path(@booking), class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded' %>
          <%= link_to 'Wróć', dashboard_index_path, class: 'bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded' %>
          <%= button_to 'Zakończ zlecenie z proponowaną ceną', complete_with_offered_price_booking_path(@booking), method: :post, class: 'bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded' %>
          <button id="open-modal-btn" class="bg-yellow-500 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded">Negocjuj proponowaną cenę</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal -->
<div id="modal" class="fixed inset-0 hidden items-center justify-center z-50">
  <div class="bg-black bg-opacity-50 absolute inset-0"></div>
  <div class="bg-white rounded-lg shadow-lg p-6 z-50 w-full max-w-lg mx-auto">
    <h2 class="text-2xl font-semibold mb-4">Negocjuj proponowaną cenę</h2>
    <%= form_with url: negotiate_price_booking_path(@booking), method: :post, local: true do |form| %>
      <div class="mb-4">
        <%= form.label :new_price_offer, "Nowa cena", class: "block text-sm font-medium text-gray-700" %>
        <%= form.number_field :new_price_offer, placeholder: "Nowa cena", class: "form-input mt-1 block w-full" %>
      </div>
      <div class="flex justify-end space-x-4">
        <button type="button" id="close-modal-btn" class="bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">Anuluj</button>
        <%= form.submit 'Wyślij', class: 'bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded' %>
      </div>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const openModalBtn = document.getElementById('open-modal-btn');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const modal = document.getElementById('modal');

    openModalBtn.addEventListener('click', function() {
      modal.classList.remove('hidden');
      modal.classList.add('flex');
    });

    closeModalBtn.addEventListener('click', function() {
      modal.classList.remove('flex');
      modal.classList.add('hidden');
    });
  });
</script>
