<div class="bg-gray-100 overflow-x-hidden">
  <nav class="bg-white px-6 py-4 shadow">
    <div class="flex flex-col container mx-auto md:flex-row md:items-center md:justify-between">
      <div class="flex justify-between items-center">
        <div>
          <a href="/" class="text-gray-800 text-xl font-bold md:text-2xl">Worxy</a>
        </div>
      </div>
      <div class="md:flex flex-col md:flex-row md:-mx-4 hidden">
        <%= render '/shared/dashboard/links' %>
      </div>
    </div>
  </nav>
  <div id="map" style="height: 500px;"></div>
</div>

<script>
  function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: -34.397, lng: 150.644},
      zoom: 8
    });

    var markers = [];

    <% @posts.each do |post| %>
      var marker = new google.maps.Marker({
        position: { lat: <%= post.latitude %>, lng: <%= post.longitude %> },
        map: map,
        title: "<%= post.title %>"
      });

      var infowindow = new google.maps.InfoWindow({
        content: `<h3><%= post.title %></h3><p><%= post.description %></p>`
      });

      marker.addListener('click', function() {
        infowindow.open(map, marker);
      });

      markers.push(marker);
    <% end %>

    <% @bookings.each do |booking| %>
      var bookingMarker = new google.maps.Marker({
        position: { lat: <%= booking.post.latitude %>, lng: <%= booking.post.longitude %> },
        map: map,
        title: "Booking for <%= booking.post.title %>"
      });

      var bookingInfowindow = new google.maps.InfoWindow({
        content: `<h3>Booking for <%= booking.post.title %></h3><p>Booked by: <%= booking.user.email %></p>`
      });

      bookingMarker.addListener('click', function() {
        bookingInfowindow.open(map, bookingMarker);
      });

      markers.push(bookingMarker);
    <% end %>
  }

  document.addEventListener('DOMContentLoaded', function() {
    initMap();
  });
</script>
