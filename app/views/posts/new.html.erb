<div class="w-full max-w-lg mx-auto my-10 bg-white p-8 border border-gray-300 rounded-lg shadow-lg">
  <%= form_with model: @post, id: dom_id(@post), local: true do |f| %>
    <div class="mb-6">
      <%= f.label :title, class: 'block text-gray-700 text-sm font-bold mb-2' %>
      <%= f.text_field :title, class: 'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline' %>
    </div>
    <div class="mb-6">
      <%= f.label :description, class: 'block text-gray-700 text-sm font-bold mb-2' %>
      <%= f.text_area :description, class: 'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline', rows: 3 %>
    </div>
    <div class="mb-6">
      <%= f.label :images, class: 'block text-gray-700 text-sm font-bold mb-2' %>
      <%= f.file_field :images, multiple: true, class: 'block w-full text-sm text-gray-700 border rounded cursor-pointer focus:outline-none focus:border-purple-500' %>
    </div>
    <div class="grid grid-cols-2 gap-4 mb-6">
      <div>
        <%= f.label :latitude, class: 'block text-gray-700 text-sm font-bold mb-2' %>
        <%= f.text_field :latitude, class: 'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline', readonly: true %>
      </div>
      <div>
        <%= f.label :longitude, class: 'block text-gray-700 text-sm font-bold mb-2' %>
        <%= f.text_field :longitude, class: 'shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline', readonly: true %>
      </div>
    </div>
    <div class="mb-6">
      <div id="map" style="height: 300px;" class="w-full h-64 border rounded-lg"></div>
    </div>
    <%= f.submit 'Submit', class: 'w-full bg-purple-500 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline' %>
  <% end %>
</div>
<script>
  function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: -34.397, lng: 150.644},
      zoom: 8
    });

    var marker;

    google.maps.event.addListener(map, 'click', function(event) {
      var lat = event.latLng.lat();
      var lng = event.latLng.lng();

      document.getElementById('post_latitude').value = lat;
      document.getElementById('post_longitude').value = lng;

      if (marker) {
        marker.setPosition(event.latLng);
      } else {
        marker = new google.maps.Marker({
          position: event.latLng,
          map: map
        });
      }
    });

    // Try HTML5 geolocation to center the map on user's location
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        function(position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          map.setCenter(pos);
        },
        function() {
          handleLocationError(true, map.getCenter());
        }
      );
    } else {
      // Browser doesn't support Geolocation
      handleLocationError(false, map.getCenter());
    }
  }

  function handleLocationError(browserHasGeolocation, pos) {
    var infoWindow = new google.maps.InfoWindow({
      position: pos,
      content: browserHasGeolocation ?
               'Error: The Geolocation service failed.' :
               'Error: Your browser doesn\'t support geolocation.'
    });
    infoWindow.open(map);
  }

  document.addEventListener('DOMContentLoaded', function() {
    initMap();
  });
</script>
